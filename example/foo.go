package main

import (
	"fmt"

	"github.com/sirupsen/logrus"
	"github.com/zartbot/holtwinters"
)

func main() {
	data := []float64{80115, 79885, 89325, 101930, 121630, 116475, 106495, 102795, 108055, 116125, 131030, 149020, 157590, 150715, 149295, 150100, 144780, 150690, 163840, 166235, 139520, 105895, 96780, 82520, 80125, 75335, 85105, 102080, 125135, 118030, 109225, 102475, 102240, 115840, 130540, 144325, 148970, 149150, 148040, 148810, 149830, 150570, 149440, 150520, 129130, 103815, 92175, 82765, 76315, 75130, 82640, 88795, 118430, 115190, 110940, 98860, 104185, 108665, 126640, 140435, 152470, 146275, 148020, 147735, 145750, 149285, 159725, 161085, 135520, 112945, 100200, 87615, 87835, 88845, 92350, 104465, 115940, 128950, 141385, 144440, 143250, 133190, 131240, 142480, 157375, 152500, 153735, 151195, 150645, 147435, 152525, 146875, 125245, 117925, 96700, 93610, 89060, 89345, 90575, 98290, 112570, 129470, 141405, 152560, 152580, 141170, 147550, 161110, 166335, 166780, 163140, 157305, 159055, 160020, 168345, 169900, 142710, 112955, 97345, 81675, 79510, 78350, 88045, 99790, 123780, 111325, 99440, 97655, 97655, 102565, 119930, 135755, 140120, 141730, 142220, 145360, 145335, 150410, 161520, 153415, 134720, 107065, 95045, 79515, 78335, 74670, 81990, 97950, 119345, 113115, 98880, 94000, 93660, 104185, 119750, 135990, 146455, 139165, 147225, 144935, 151370, 156080, 161385, 165010, 134090, 105585, 92855, 79270, 79980, 78110, 85785, 100010, 123880, 116335, 104290, 101440, 97635, 108265, 121250, 140850, 138555, 140990, 141525, 141590, 140610, 139515, 146215, 142425, 123945, 101360, 88170, 76050, 70335, 72150, 80195, 94945}
	/*
		model := &holtwinters.HoltWintersT{
			Series:        data,
			Alpha:         0.11652680227350454,
			Beta:          0.002677697431105852,
			Gamma:         0.05820973606789237,
			SeasonLenth:   24,
			Npreds:        50,
			ScalingFactor: 3,
		}
	*/
	p, e := holtwinters.Fit(data, 24, 3)
	if e == nil {
		logrus.Warn(p)
	} else {
		logrus.Fatal(e)
	}
	model := holtwinters.New(data, 24, 50, p.Alpha, p.Beta, p.Gamma, 3)
	model.TripleExponentialSmoothing()
	for k, v := range model.Result {
		fmt.Println(k, "--", v)
	}

	mse, err := holtwinters.TimeSplitMSE(data, 0.11652680227350454, 0.002677697431105852, 0.05820973606789237, 24, 3)
	if err != nil {
		logrus.Fatal(err)
	}
	logrus.Warn("Old:", mse)

	mse, err = holtwinters.TimeSplitMSE(data, p.Alpha, p.Beta, p.Gamma, 24, 3)
	if err != nil {
		logrus.Fatal(err)
	}
	logrus.Warn("New:", mse)

	/*
		for k, v := range model.Result {
			fmt.Println(k, "--", v)
		}*/
}
